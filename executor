#!/bin/bash

# Starting block number
start_block=47961368
# Number of blocks to increment each iteration
block_increment=50

# Loop to fetch events in increments of 50 blocks
while true; do
  end_block=$((start_block + block_increment - 1))

  echo "Fetching events from block $start_block to $end_block"

  # Execute the curl command to fetch events
  curl -X POST http://localhost:3000/api/fees/fetch-events \
    -H "Content-Type: application/json" \
    -d '{
      "fromBlock": '"$start_block"',
      "toBlock": '"$end_block"'
    }'

  # Check if the curl command was successful
  if [ $? -ne 0 ]; then
    echo "Error fetching events"
    break
  fi

  # Increment the start block for the next iteration
  start_block=$((end_block + 1))

  # Optionally, add a sleep interval to avoid overloading the server
  # sleep 2
done
